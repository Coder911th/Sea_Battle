{"version":3,"sources":["handlers.js"],"names":["seaBattle","socket","$","one","fadeOut","delay","fadeIn","WebSocket","location","hostname","onmessage","webSocketMessageHander","sendJSON","object","send","JSON","stringify","onclose","onerror","console","log","window","on","type","id","parent","data","name","val","click","removeClass","addClass","css","display","opacity","animate","focus","keypress","e","key","undefined","queue","next","userName","roomName","ai","text","increment","prev","trim","target","toggleClass","state","readyState","map","ships","iMove","hasClass","closest","x","y","look","printMap","gameOver","confirm","currentRoom"],"mappings":";;AAAA;;AAEA,KAAK,UAASA,SAAT,EAAoB;;AAErB;AACI;AACAC,aAAS,IAFb;;AAIA;AACAC,MAAE,8BAAF,EACKC,GADL,CACS,OADT,EACkB,YAAW;AACrB;AACAD,UAAE,eAAF,EACKE,OADL,CACa,GADb;AAEAF,UAAE,sBAAF,EACKG,KADL,CACW,GADX,EAEKC,MAFL,CAEY,GAFZ;;AAIA;AACAL,iBAAS,IAAIM,SAAJ,WAAsBC,SAASC,QAA/B,iBAAT;AACA;AACAR,eAAOS,SAAP,GAAmBV,UAAUW,sBAA7B;AACA;AACAV,eAAOW,QAAP,GAAkB,UAASC,MAAT,EAAiB;AAC/B,iBAAKC,IAAL,CAAUC,KAAKC,SAAL,CAAeH,MAAf,CAAV;AACH,SAFD;;AAIA;AACAZ,eAAOgB,OAAP,GAAiBhB,OAAOiB,OAAP,GAAiBC,QAAQC,GAA1C;;AAEAC,eAAOpB,MAAP,GAAgBA,MAAhB,CApBqB,CAoBG;AAC3B,KAtBL;;AAwBA;AACAC,MAAE,4BAAF,EACKoB,EADL,CACQ,OADR,EACiB,mBADjB,EACsC,YAAW;AACzC;AACArB,eAAOW,QAAP,CAAgB;AACZW,kBAAM,WADM;AAEZC,gBAAItB,EAAE,IAAF,EAAQuB,MAAR,GAAiBC,IAAjB,CAAsB,IAAtB,CAFQ;AAGZC,kBAAMzB,EAAE,WAAF,EAAe0B,GAAf;AAHM,SAAhB;AAKH,KARL;;AAUA;AACA1B,MAAE,cAAF,EACK2B,KADL,CACW,YAAW;AACd;AACA3B,UAAE,QAAF,EACK4B,WADL,CACiB,OADjB,EAEKC,QAFL,CAEc,QAFd,EAGKC,GAHL,CAGS;AACDC,qBAAS,MADR;AAEDC,qBAAS;AAFR,SAHT,EAOKC,OAPL,CAOa;AACLD,qBAAS;AADJ,SAPb,EASO,GATP;;AAWAhC,UAAE,gBAAF,EACKkC,KADL;AAEH,KAhBL;;AAkBA;AACAlC,MAAE,gBAAF,EAAoBmC,QAApB,CAA6B;AAAA,eAAKC,EAAEC,GAAF,KAAU,OAAV,GAC5BrC,EAAE,eAAF,EAAmB2B,KAAnB,EAD4B,GAE5BW,SAFuB;AAAA,KAA7B;;AAIA;AACAtC,MAAE,gBAAF,EACK2B,KADL,CACW,YAAW;AACd3B,UAAE,QAAF,EACKiC,OADL,CACa;AACLD,qBAAS;AADJ,SADb,EAGO,GAHP,EAIKO,KAJL,CAIW,UAASC,IAAT,EAAe;AAClBxC,cAAE,IAAF,EACK8B,GADL,CACS,SADT,EACoB,MADpB,EAEKF,WAFL,CAEiB,QAFjB,EAGKA,WAHL,CAGiB,OAHjB;AAIAY;AACH,SAVL;AAWH,KAbL;;AAeA;AACAxC,MAAE,eAAF,EACK2B,KADL,CACW;AAAA,eAAM5B,OAAOW,QAAP,CAAgB;AACzBW,kBAAM,aADmB;AAEzBoB,sBAAUzC,EAAE,WAAF,EAAe0B,GAAf,EAFe;AAGzBgB,sBAAU1C,EAAE,gBAAF,EAAoB0B,GAApB;AAHe,SAAhB,CAAN;AAAA,KADX;;AAOA;AACA1B,MAAE,wBAAF,EACK2B,KADL,CACW,YAAW;AACd;AACA,YAAIgB,KAAK3C,EAAE,IAAF,EACJwC,IADI,GAEJI,IAFI,EAAT;;AAIA,YAAID,MAAM,GAAV,EAAe;AACX;;AAEJ;AACA5C,eAAOW,QAAP,CAAgB;AACZW,kBAAM,gBADM;AAEZwB,uBAAW;AAFC,SAAhB;AAIH,KAfL;;AAiBA;AACA7C,MAAE,yBAAF,EACK2B,KADL,CACW,YAAW;AACd;AACA,YAAIgB,KAAK3C,EAAE,IAAF,EACJ8C,IADI,GAEJF,IAFI,EAAT;;AAIA;AACA7C,eAAOW,QAAP,CAAgB;AACZW,kBAAM,gBADM;AAEZwB,uBAAW;AAFC,SAAhB;AAIH,KAZL;;AAcA;AACA7C,MAAE,iBAAF,EACK2B,KADL,CACW,YAAW;AACd5B,eAAOW,QAAP,CAAgB,EAAEW,MAAM,YAAR,EAAhB;;AAEA;AACArB,UAAE,YAAF,EACKiC,OADL,CACa;AACLD,qBAAS;AADJ,SADb,EAGO,GAHP,EAIKO,KAJL,CAIW,UAASC,IAAT,EAAe;AAClBxC,cAAE,IAAF,EACK8B,GADL,CACS,SADT,EACoB,MADpB;AAEAU;AACH,SARL;;AAUAxC,UAAE,sBAAF,EACKG,KADL,CACW,GADX,EAEKC,MAFL,CAEY,GAFZ;AAGH,KAlBL;;AAoBA;AACAJ,MAAE,eAAF,EACK2B,KADL,CACW,YAAW;AACd,YAAIiB,OAAO5C,EAAE,IAAF,EAAQ8C,IAAR,GAAepB,GAAf,GAAqBqB,IAArB,EAAX;;AAEA,YAAIH,QAAQ,EAAZ,EAAgB;AACZ;;AAEJ7C,eAAOW,QAAP,CAAgB;AACZW,kBAAM,MADM;AAEZuB;AAFY,SAAhB;AAIH,KAXL;;AAaA;AACA5C,MAAE,aAAF,EAAiBmC,QAAjB,CAA0B;AAAA,eAAKC,EAAEC,GAAF,KAAU,OAAV,GACzBrC,EAAE,eAAF,EAAmB2B,KAAnB,EADyB,GAEvBW,SAFkB;AAAA,KAA1B;;AAIA;AACAtC,MAAE,kBAAF,EACKoB,EADL,CACQ,OADR,EACiB,OADjB,EAC0B,YAAW;AAC7BrB,eAAOW,QAAP,CAAgB;AACZW,kBAAM,MADM;AAEZ2B,oBAAQhD,EAAE,IAAF,EAAQuB,MAAR,GAAiBqB,IAAjB;AAFI,SAAhB;AAIH,KANL;;AAQA;AACA5C,MAAE,aAAF,EACK2B,KADL,CACW,YAAW;AACd;AACA5B,eAAOW,QAAP,CAAgB;AACZW,kBAAM;AADM,SAAhB;AAGH,KANL;;AAQA;AACArB,MAAE,QAAF,EACK2B,KADL,CACW,YAAW;AACd3B,UAAE,IAAF,EAAQiD,WAAR,CAAoB,QAApB;;AAEAlD,eAAOW,QAAP,CAAgB;AACZW,kBAAM,oBADM;AAEZ6B,mBAAOpD,UAAUqD,UAAV,GAAuB,CAACrD,UAAUqD,UAF7B;AAGZC,iBAAKtD,UAAUqD,UAAV,GAAuBrD,UAAUuD,KAAjC,GAAyC;AAHlC,SAAhB;;AAMArD,UAAE,YAAF,EACKiD,WADL,CACiB,OADjB;AAEH,KAZL;;AAcA;AACAjD,MAAE,cAAF,EACKoB,EADL,CACQ,OADR,EACiB,IADjB,EACuB,YAAW;AAC1B;AACA,YAAI,CAACtB,UAAUwD,KAAf,EACI;;AAEJ;AACA,YAAItD,EAAE,IAAF,EAAQwB,IAAR,CAAa,GAAb,KAAqBc,SAAzB,EACI;;AAEJ;AACA,YAAItC,EAAE,IAAF,EAAQuD,QAAR,CAAiB,MAAjB,KAA4BvD,EAAE,IAAF,EAAQuD,QAAR,CAAiB,MAAjB,CAAhC,EACI;;AAEJ,YAAIvD,EAAE,IAAF,EAAQwD,OAAR,CAAgB,QAAhB,EAA0BD,QAA1B,CAAmC,OAAnC,CAAJ,EACI,OAdsB,CAcd;;AAEZxD,eAAOW,QAAP,CAAgB;AACZW,kBAAM,QADM;AAEZ2B,oBAAQhD,EAAE,mBAAF,EAAuB4C,IAAvB,EAFI;AAGZa,eAAGzD,EAAE,IAAF,EAAQwB,IAAR,CAAa,GAAb,CAHS;AAIZkC,eAAG1D,EAAE,IAAF,EAAQwB,IAAR,CAAa,GAAb;AAJS,SAAhB;AAOH,KAxBL;;AA0BA;AACAxB,MAAE,aAAF,EACKoB,EADL,CACQ,OADR,EACiB,IADjB,EACuB,YAAW;AAC1B,YAAItB,UAAU6D,IAAV,IAAkB,IAAtB,EAA4B;AACxB;;AAEJ,YAAIP,MAAMpD,EAAE,IAAF,EAAQwB,IAAR,CAAa,KAAb,CAAV;;AAEA;;;;AAID1B,kBAAU6D,IAAV,CAAe/B,WAAf,CAA2B,MAA3B;AACA5B,UAAE,IAAF,EAAQ6B,QAAR,CAAiB,MAAjB;AACA/B,kBAAU6D,IAAV,GAAiB3D,EAAE,IAAF,CAAjB;;AAEC,YAAIF,UAAU6D,IAAV,CAAeJ,QAAf,CAAwB,SAAxB,CAAJ,EACIvD,EAAE,cAAF,EAAkB6B,QAAlB,CAA2B,OAA3B,EADJ,KAGI7B,EAAE,cAAF,EAAkB4B,WAAlB,CAA8B,OAA9B;;AAEL9B,kBAAU8D,QAAV,CAAmBR,GAAnB,EAnB2B,CAmBF;AAC3B,KArBL;;AAuBA;AACApD,MAAE,UAAF,EACK2B,KADL,CACW,YAAW;AACd,YAAI7B,UAAU+D,QAAV,IAAsBC,QAAQ,kCAAR,CAA1B,EAAuE;AACnE/D,mBAAOW,QAAP,CAAgB;AACZW,sBAAM;AADM,aAAhB;;AAIA;AACArB,cAAE,YAAF,EACKiC,OADL,CACa;AACLD,yBAAS;AADJ,aADb,EAGO,GAHP,EAIKO,KAJL,CAIW,UAASC,IAAT,EAAe;AAClBxC,kBAAE,IAAF,EAAQ8B,GAAR,CAAY,EAAEC,SAAS,MAAX,EAAZ;AACAS;AACH,aAPL;;AASAxC,cAAE,sBAAF,EACKG,KADL,CACW,GADX,EAEKC,MAFL,CAEY,GAFZ;;AAIA;AACAN,sBAAUiE,WAAV,GAAwB,IAAxB;AACAjE,sBAAUqD,UAAV,GAAuB,KAAvB;AACArD,sBAAU6D,IAAV,GAAiB,IAAjB;AACA7D,sBAAUwD,KAAV,GAAkB,KAAlB;AACAxD,sBAAU+D,QAAV,GAAqB,KAArB;AACA/D,sBAAUuD,KAAV,GAAkB,CAAC,EAAD,EAAK,EAAL,EAAS,EAAT,EAAa,EAAb,EAAiB,EAAjB,EAAqB,EAArB,EAAyB,EAAzB,EAA6B,EAA7B,EAAiC,EAAjC,EAAqC,EAArC,CAAlB;AACH;AACJ,KA7BL;AA+BH,CAvRI,CAuRHvD,SAvRG,CAAL","file":"../../js/handlers.js","sourcesContent":["/**** Установка обработчиков ****/\r\n\r\nvoid function(seaBattle) {\r\n\r\n    let\r\n        // WebSocket\r\n        socket = null;\r\n\r\n    // Обработчик кнопки \"Подобрать игровую комнату\"\r\n    $('#start-selecting-room-button')\r\n        .one('click', function() {\r\n            // Переходим к странице с выбором комнаты\r\n            $('.welcome-page')\r\n                .fadeOut(500);    \r\n            $('.room-selection-page')\r\n                .delay(500)\r\n                .fadeIn(500);\r\n\r\n            // Подключаемся к WebSocket-серверу\r\n            socket = new WebSocket(`ws://${location.hostname}:80/connect`);\r\n            // Подключаем обработку сообщений (файл webSocketMessageHander.js)\r\n            socket.onmessage = seaBattle.webSocketMessageHander;\r\n            // Пользовательская функция для отправки JSON-объектов по WebSocket\r\n            socket.sendJSON = function(object) {\r\n                this.send(JSON.stringify(object));\r\n            }\r\n\r\n            // DEBUG\r\n            socket.onclose = socket.onerror = console.log;\r\n\r\n            window.socket = socket; // DEBUG\r\n        });\r\n\r\n    // Обрабатываем выбор игровой комнаты в таблице\r\n    $('.room-selection-page table')\r\n        .on('click', 'td:not([colspan])', function() {\r\n            // Отправляем запрос на присоединение\r\n            socket.sendJSON({\r\n                type: 'join-room',\r\n                id: $(this).parent().data('id'),\r\n                name: $('#nickname').val()\r\n            });\r\n        });\r\n\r\n    // Обработчик кнопки \"Создать комнату\"\r\n    $('#create-room')\r\n        .click(function() {\r\n            // Показываем popup с просьбой ввести название комнаты\r\n            $('.popup')\r\n                .removeClass('alert')\r\n                .addClass('prompt')\r\n                .css({\r\n                    display: 'flex',\r\n                    opacity: 0\r\n                })\r\n                .animate({\r\n                    opacity: 1\r\n                }, 500);\r\n\r\n            $('#popup-textbox')\r\n                .focus();\r\n        });\r\n\r\n    // Обрабатываем клавишу Enter для поля ввода в popup\r\n    $('#popup-textbox').keypress(e => e.key === \"Enter\"\r\n        ? $('#popup-button').click()\r\n        : undefined);\r\n\r\n    // Обработчик закрытия popup\r\n    $('.popup .cancel')\r\n        .click(function() {\r\n            $('.popup')\r\n                .animate({\r\n                    opacity: 0\r\n                }, 500)\r\n                .queue(function(next) {\r\n                    $(this)\r\n                        .css('display', 'none')\r\n                        .removeClass('prompt')\r\n                        .removeClass('alert');\r\n                    next();\r\n                });\r\n        });\r\n\r\n    // Кнопка \"Создать\" в popup\r\n    $('#popup-button')\r\n        .click(() => socket.sendJSON({\r\n            type: 'create-room',\r\n            userName: $('#nickname').val(),\r\n            roomName: $('#popup-textbox').val()\r\n        }));\r\n    \r\n    /* Стрелка, уменьшающая на единицу количество AI в комнате */\r\n    $('.room-page .arrow.left')\r\n        .click(function() {\r\n            // Получаем текущее количество AI\r\n            let ai = $(this)\r\n                .next()\r\n                .text();\r\n\r\n            if (ai == '0') // Если убавлять уже некуда, ничего не делаем\r\n                return;\r\n            \r\n            // Отправляем запрос на изменение числа AI\r\n            socket.sendJSON({\r\n                type: 'update-ai-info',\r\n                increment: false\r\n            })\r\n        });\r\n\r\n    /* Стрелка, увеличивающая на единицу количество AI в комнате */\r\n    $('.room-page .arrow.right')\r\n        .click(function() {\r\n            // Получаем текущее количество AI\r\n            let ai = $(this)\r\n                .prev()\r\n                .text();\r\n            \r\n            // Отправляем запрос на изменение числа AI\r\n            socket.sendJSON({\r\n                type: 'update-ai-info',\r\n                increment: true\r\n            })\r\n        });\r\n\r\n    /* Кнопка, которая приводит к выходу из комнаты */\r\n    $('#exit-from-room')\r\n        .click(function() {\r\n            socket.sendJSON({ type: 'leave-room' });\r\n\r\n            // Переход к selecting-room-page\r\n            $('.room-page')\r\n                .animate({\r\n                    opacity: 0\r\n                }, 500)\r\n                .queue(function(next) {\r\n                    $(this)\r\n                        .css('display', 'none');\r\n                    next();\r\n                });\r\n            \r\n            $('.room-selection-page')\r\n                .delay(500)\r\n                .fadeIn(500);\r\n        });\r\n\r\n    /* Кнопка отправки сообщения в чат комнаты */\r\n    $('#send-message')\r\n        .click(function() {\r\n            let text = $(this).prev().val().trim();\r\n\r\n            if (text == '') // Были введены одни пробельные символы\r\n                return;\r\n\r\n            socket.sendJSON({\r\n                type: 'chat',\r\n                text\r\n            });\r\n        });\r\n\r\n    // Привязываем клавишу Enter поля ввода сообщения чата к кнопке \"Отправить\"\r\n    $('#chat-input').keypress(e => e.key === \"Enter\"\r\n        ? $('#send-message').click()\r\n        :   undefined);\r\n\r\n    /* Обработка кнопок кика игроков из комнаты */\r\n    $('.room-page tbody')\r\n        .on('click', '.kick', function() {\r\n            socket.sendJSON({\r\n                type: 'kick',\r\n                target: $(this).parent().text()\r\n            });\r\n        });\r\n\r\n    /* Кнопка запуска игры в комнате */\r\n    $('#start-game')\r\n        .click(function() {\r\n            // Запрос на запуск игры\r\n            socket.sendJSON({\r\n                type: 'start-game'\r\n            });\r\n        });\r\n\r\n    /* Кнопка смены состояния в игре */\r\n    $('#ready')\r\n        .click(function() {\r\n            $(this).toggleClass('active');\r\n            \r\n            socket.sendJSON({\r\n                type: 'change-ready-state',\r\n                state: seaBattle.readyState = !seaBattle.readyState,\r\n                map: seaBattle.readyState ? seaBattle.ships : null\r\n            });\r\n\r\n            $('.game-page')\r\n                .toggleClass('ready');\r\n        });\r\n\r\n    // Обработчик атаки по противнику\r\n    $('.enemy.field')\r\n        .on('click', 'td', function() {\r\n            // Если не мой ход, то ничего не делаем\r\n            if (!seaBattle.iMove)\r\n                return;\r\n\r\n            // Кликнули по подписям к строкам и столбцам таблицы\r\n            if ($(this).data('x') == undefined)\r\n                return;\r\n\r\n            // Уже стреляли по этой ячейке\r\n            if ($(this).hasClass('ship') || $(this).hasClass('miss'))\r\n                return;\r\n\r\n            if ($(this).closest('.field').hasClass('block'))\r\n                return; // Ходить по выбранному игроку нельзя\r\n                \r\n            socket.sendJSON({\r\n                type: 'attack',\r\n                target: $('.enemy-list .look').text(),\r\n                x: $(this).data('x'),\r\n                y: $(this).data('y')\r\n            });\r\n            \r\n        });\r\n\r\n    // Обработчик выбора просматриваемого противника\r\n    $('.enemy-list')\r\n        .on('click', 'li', function() {\r\n            if (seaBattle.look == null) // Игра ещё не началась\r\n                return;\r\n\r\n            let map = $(this).data('map');\r\n\r\n            /*\r\n                Выделяем выбранного игрока в списке и \r\n                снимаем выделение с предыдущего \r\n            */\r\n           seaBattle.look.removeClass('look');\r\n           $(this).addClass('look');\r\n           seaBattle.look = $(this);\r\n\r\n            if (seaBattle.look.hasClass('give-up'))\r\n                $('.enemy.field').addClass('block');\r\n            else\r\n                $('.enemy.field').removeClass('block');\r\n\r\n           seaBattle.printMap(map); // Выводим карту противника\r\n        });\r\n\r\n    // Кнопочка \"Сдаюсь\"\r\n    $('#give-up')\r\n        .click(function() {\r\n            if (seaBattle.gameOver || confirm('Вы действительно хотите сдаться?')) {\r\n                socket.sendJSON({\r\n                    type: 'give-up'\r\n                });\r\n\r\n                // Переходим к окну выбора комнаты\r\n                $('.game-page')\r\n                    .animate({\r\n                        opacity: 0\r\n                    }, 500)\r\n                    .queue(function(next) {\r\n                        $(this).css({ display: 'none' });\r\n                        next();\r\n                    });\r\n                \r\n                $('.room-selection-page')\r\n                    .delay(500)\r\n                    .fadeIn(500);\r\n\r\n                // RESET\r\n                seaBattle.currentRoom = null;\r\n                seaBattle.readyState = false;\r\n                seaBattle.look = null;\r\n                seaBattle.iMove = false;\r\n                seaBattle.gameOver = false;\r\n                seaBattle.ships = [[], [], [], [], [], [], [], [], [], []];\r\n            }\r\n        });\r\n\r\n}(seaBattle);"]}
{"version":3,"sources":["webSocketMessageHander.js"],"names":["seaBattle","printMap","UNKNOWN_CELL","MISS_CELL","HIT_CELL","SAVED_CELL","upperAlphabet","$myFieldData","$","filter","find","webSocketMessageHander","msg","JSON","parse","data","console","log","type","rooms","length","css","forEach","createTableRow","text","message","removeClass","addClass","display","opacity","animate","room","html","currentRoom","id","nickName","val","fadeOut","queue","next","delay","prop","end","roomName","userName","close","remove","rows","roomDataElements","children","ai","eq","players","tableMarkup","playerName","admin","printToChat","append","kicked","name","each","parent","fadeIn","enemies","splice","indexOf","gameOver","map","enemy","join","readyState","index","item","state","hide","slideDown","selectMover","look","first","items","i","lost","searchEnemy","myMap","realMap","hasClass","printHistory","x","y","hit","misses","target","source","miss","move","iMove","callbackSuccess","callbackFail","appendTo","get","escapeHtml","replace","a","nick","chat","scrollTop","scrollHeight","td","cell","Math","floor","undefined","$history","res","String","fromCharCode"],"mappings":"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","file":"../../js/webSocketMessageHander.js","sourcesContent":["void function(seaBattle) {\r\n\r\n    seaBattle.printMap = printMap;\r\n\r\n    /**** Обработчик сообщений от WebSocket-сервера ****/\r\n\r\n    const\r\n        // Константы, определяющие тип ячейки на карте\r\n        UNKNOWN_CELL  = 0, // Не известно, есть ли там что-либо\r\n        MISS_CELL     = 1, // В этой ячейке мы промахнулись\r\n        HIT_CELL      = 2, // В этой ячейке мы попали по вражескому кораблю\r\n        SAVED_CELL    = 3, // Этот корабль мы не успели подстрелить, противник либо выйграл, либо сдался\r\n        upperAlphabet = ['А', 'Б', 'В', 'Г', 'Д', 'Е', 'Ж', 'З', 'И', 'К']; // Вспомогательный алфавит\r\n\r\n    let $myFieldData = $('.my.field tr')\r\n        .filter(':gt(0)')\r\n        .find('td')\r\n        .filter(':not(:first-of-type)');\r\n\r\n    seaBattle.webSocketMessageHander = function(msg) {\r\n        // Парсим строку с сообщением в объект\r\n        msg = JSON.parse(msg.data);\r\n        console.log(msg); // DEBUG\r\n        \r\n        switch (msg.type) {\r\n            case 'getting-rooms':\r\n                /**\r\n                 * Сервер сразу после подключения высылает все \r\n                 * созданные на данный момент комнаты клиенту \r\n                 **/\r\n                \r\n                if (msg.rooms.length == 0) {\r\n                    /* Если нет ни одой созданной комнаты\r\n                    Показываем сообщение об этом */\r\n                    $('.no-rooms-message')\r\n                        .css('display', 'table-row');\r\n                    return;\r\n                }\r\n\r\n                // Добавляем комнаты в таблицу\r\n                msg.rooms.forEach(createTableRow);\r\n                break;\r\n            case 'error':\r\n                /* Произошла ошибка, выводим popup с её текстом */\r\n                $('.popup .message')\r\n                    .text(msg.message);\r\n                $('.popup')\r\n                    .removeClass('prompt')\r\n                    .addClass('alert')\r\n                    .css({\r\n                        display: 'flex',\r\n                        opacity: 0\r\n                    })\r\n                    .animate({\r\n                        opacity: 1\r\n                    }, 500);\r\n                break;\r\n            case 'new-room':\r\n                /* Была создана новая комната */\r\n                $('.no-rooms-message')\r\n                    .css('display', '')\r\n\r\n                createTableRow(msg.room);\r\n                break;\r\n            case 'room-created':\r\n                /*\r\n                    Комната была успешно создана\r\n                    msg.id       - id комнаты\r\n                    msg.userName - ваш ник\r\n                    msg.roomName - имя комнаты\r\n                */\r\n\r\n                // Очищаем чат\r\n                $('.chat .messages')\r\n                    .html('');\r\n\r\n                // Устанавливаем id текущей комнаты\r\n                seaBattle.currentRoom = msg.id;\r\n\r\n                // Сохраняем имя создателя комнаты\r\n                seaBattle.nickName = $('#nickname').val();\r\n\r\n                // Скрываем popup\r\n                $('.popup')\r\n                    .fadeOut(300)\r\n                    .queue(function(next) {\r\n                        $(this)\r\n                            .removeClass('prompt')\r\n                            .removeClass('alert');\r\n                        next();\r\n                    });\r\n\r\n                // Скрываем страницу с выбором комнаты\r\n                $('.room-selection-page')\r\n                    .fadeOut(300);\r\n                \r\n                // Показываем страницу с комнатой\r\n                $('.room-page')\r\n                    // Устанавливаем админку\r\n                    .addClass('admin')\r\n                    .delay(300)\r\n                    // Анимация перехода между страницами\r\n                    .queue(function(next) {\r\n                        $(this)\r\n                            .css({\r\n                                display: 'flex',\r\n                                opacity: 0\r\n                            })\r\n                        next();\r\n                    })\r\n                    .animate({\r\n                        opacity: 1\r\n                    }, 500)\r\n                    // Разблокировка кнопки \"Начать игру\"\r\n                    .find('#start-game')\r\n                        .prop('disabled', false)\r\n                        .end()\r\n                    // Настраиваем комнату\r\n                    .find('#room-name')\r\n                        .text(msg.roomName)\r\n                        .end()\r\n                    .find('#admin-name')\r\n                        .text(msg.userName)\r\n                        .end()\r\n                    .find('#ai-counter')\r\n                        .text('0')\r\n                        .end()\r\n                    // Добавляем себя в список игроков комнаты\r\n                    .find('tbody')\r\n                        .html(\r\n                            `<tr>\r\n                                <td class=\"you\">${msg.userName}<span class=\"kick\"></span></td>\r\n                            </tr>`\r\n                        );\r\n                break;\r\n            case 'update-room-info':\r\n                /* Обновлена информация о комнатах */\r\n\r\n                if (msg.close) {\r\n                    // Закрываем комнату\r\n                    $(seaBattle.rooms[msg.id]).remove(); // Удаляем строку из таблицы\r\n                    delete seaBattle.rooms[msg.id]; // Удаляем информацию о комнате\r\n                    \r\n                    let rows = $('.room-selection-page tr')\r\n                        .filter(':gt(0)')\r\n                        .length;\r\n\r\n                    if (rows == 1)\r\n                        $('.no-rooms-message') // Показываем сообщение об отсутствии комнат\r\n                            .css('display', 'table-row');\r\n                    \r\n                    return;\r\n                        \r\n                }\r\n                \r\n                // Получаем <td> таблицы с измененной комнатой (DOM-элемент)\r\n                // Первый - имя комнаты, второй - количество AI, третий - количество игроков\r\n                let roomDataElements = $(seaBattle.rooms[msg.id]).children();\r\n                \r\n                // Обновляем информацию в таблице\r\n                msg.ai      != null ? roomDataElements.eq(1).text(msg.ai)      : null;\r\n                msg.players != null ? roomDataElements.eq(2).text(msg.players) : null;\r\n\r\n                if (seaBattle.currentRoom == msg.id && msg.ai != null) {\r\n                    /* Мы находимся в обновленной комнате и изменилось количество AI */\r\n                    $('#ai-counter')\r\n                        .text(msg.ai); // Обновляем информацию\r\n                }\r\n\r\n                break;\r\n            case 'joined':\r\n                /* \r\n                    Вы успешно присоединились к комнате\r\n                    msg.id       - идентификатор комнаты\r\n                    msg.userName - ваш ник\r\n                    msg.roomName - название комнты\r\n                    msg.ai       - количество ботов\r\n                    msg.players  - массив имён реальных игроков\r\n                    msg.admin    - имя создателя комнаты\r\n                */\r\n\r\n                // Очищаем чат\r\n                $('.chat .messages')\r\n                    .html('');\r\n\r\n                // Формируем html-разметку таблицы игроков комнаты\r\n                let tableMarkup = '';\r\n                msg.players.forEach(playerName => tableMarkup += \r\n                    `<tr>\r\n                        <td${playerName == msg.userName ? ' class=\"you\"' : ''}>${playerName}<span class=\"kick\"></span></td>\r\n                    </tr>`\r\n                );\r\n                \r\n                // Устанавливаем id текущей комнаты\r\n                seaBattle.currentRoom = msg.id;\r\n\r\n                // Скрываем popup\r\n                $('.popup') \r\n                    .fadeOut(300)\r\n                    .queue(function(next) {\r\n                        $(this)\r\n                            .removeClass('prompt')\r\n                            .removeClass('alert');\r\n                        next();\r\n                    });\r\n\r\n                // Скрываем страницу с выбором комнаты\r\n                $('.room-selection-page')\r\n                    .fadeOut(300);\r\n                \r\n                // Показываем страницу с комнатой\r\n                $('.room-page')\r\n                    // Убираем админку, если была\r\n                    .removeClass('admin')\r\n                    .delay(300)\r\n                    // Анимация перехода между страницами\r\n                    .queue(function(next) {\r\n                        $(this)\r\n                            .css({\r\n                                display: 'flex',\r\n                                opacity: 0\r\n                            })\r\n                        next();\r\n                    })\r\n                    .animate({\r\n                        opacity: 1\r\n                    }, 500)\r\n                    // Блокировка кнопки \"Начать игру\"\r\n                    .find('#start-game')\r\n                        .prop('disabled', true)\r\n                        .end()\r\n                    // Настраиваем комнату\r\n                    .find('#room-name')\r\n                        .text(msg.roomName)\r\n                        .end()\r\n                    .find('#admin-name')\r\n                        .text(msg.admin)\r\n                        .end()\r\n                    .find('#ai-counter')\r\n                        .text(msg.ai)\r\n                        .end()\r\n                    // Создаём список игроков комнаты\r\n                    .find('tbody')\r\n                        .html(tableMarkup);\r\n\r\n                    // Сохраняем ваш никнейм в пространстве имён\r\n                    seaBattle.nickName = msg.userName;\r\n\r\n                break;\r\n            case 'new-player':\r\n                /* В комнату вошёл новый игрок с именем msg.userName */\r\n                printToChat(`Игрок \"${msg.userName}\" вошёл в комнату`);\r\n                // Добавим новую строку в таблицу\r\n                $('.room-page tbody')\r\n                    .append(`\r\n                        <tr>\r\n                            <td>${msg.userName}<span class=\"kick\"></span></td>\r\n                        </tr>`\r\n                    );\r\n                \r\n                break;\r\n            case 'leave-room':\r\n                /* Игрок с именем msg.name покинул игровую комнату */\r\n                if (msg.kicked)\r\n                    printToChat(`Игрок \"${msg.name}\" был выгнан из комнаты`);\r\n                else\r\n                    printToChat(`Игрок \"${msg.name}\" покинул комнату`);\r\n                \r\n                $('.room-page td')\r\n                    .each(function() {\r\n                        if ($(this).text() == msg.name)\r\n                            $(this).parent().remove();\r\n                    });\r\n                break;\r\n            case 'new-admin':\r\n                /* У комнаты новый админ - msg.name */\r\n                $('#admin-name')\r\n                    .text(msg.name);\r\n\r\n                printToChat(`У комнаты новый администратор - ${msg.name}`);\r\n\r\n                if (seaBattle.nickName == msg.name) \r\n                    $('.room-page') // Активируем админку\r\n                        .addClass('admin')\r\n                        .find('#start-game')\r\n                            .prop('disabled', false);\r\n\r\n                break;\r\n            case 'chat':\r\n                /* Получено сообщение msg.text от msg.nickName */\r\n                printToChat(msg.text, msg.nickName);\r\n                $('#chat-input').val(''); // Очищаем поле ввода сообщения\r\n                break;\r\n            case 'kick':\r\n                /* Вас выкинули из комнаты */\r\n\r\n                // Переход к selecting-room-page\r\n                $('.room-page')\r\n                    .animate({\r\n                        opacity: 0\r\n                    }, 500)\r\n                    .queue(function(next) {\r\n                        $(this)\r\n                            .css('display', 'none');\r\n                        next();\r\n                    });\r\n                \r\n                $('.room-selection-page')\r\n                    .delay(500)\r\n                    .fadeIn(500);\r\n                \r\n                // Вывод сообщения\r\n                $('.popup')\r\n                    .removeClass('prompt')\r\n                    .addClass('alert')\r\n                    .find('.message')\r\n                        .text('Вас выгнали из комнаты! Пожалуйста, больше туда не заходите')\r\n                        .end()\r\n                    .css({\r\n                        display: 'flex',\r\n                        opacity: 0\r\n                    })\r\n                    .animate({\r\n                        opacity: 1\r\n                    }, 500);\r\n\r\n                break;\r\n            case 'start-game':\r\n                /* \r\n                    Игра началась\r\n                    msg.enemies  - массив имён противников\r\n                */\r\n\r\n                // Удаляем себя из списка врагов :)\r\n                msg.enemies.splice(msg.enemies.indexOf(seaBattle.nickName), 1);\r\n                console.log(msg.enemies);\r\n\r\n                // Сохраняем количество противников в NS\r\n                seaBattle.enemies = msg.enemies.length;\r\n\r\n                $('#give-up')\r\n                    .text('Сдаюсь');\r\n                seaBattle.gameOver = false;\r\n\r\n                $('.game-page')\r\n                    .removeClass('ready');\r\n\r\n                $('.room-page')\r\n                    .animate({\r\n                        opacity: 0\r\n                    }, 500)\r\n                    .queue(function(next) {\r\n                        $(this).css('display', 'none');\r\n                        next();\r\n                    });\r\n\r\n                $('.game-page')\r\n                    .delay(500)\r\n                    .queue(function(next) {\r\n                        $(this).css({\r\n                            display: 'flex',\r\n                            opacity: 0\r\n                        });\r\n                        next();\r\n                    })\r\n                    .animate({\r\n                        opacity: 1\r\n                    }, 500);\r\n\r\n                /* Сброс настроек после предыдущей игры */\r\n                /* Очищаем обе карты */\r\n                $('.game-page')\r\n                    .find('.field tr')\r\n                    .filter(':not(:first-of-type)')\r\n                    .find('td')\r\n                    .filter(':not(:first-of-type)')\r\n                    .removeClass('ship miss attacked');\r\n                \r\n                /* Сбрасываем остальные настройки и зановим противников в список */\r\n                $('.game-page')\r\n                    .addClass('prepare')\r\n                    .find('.status')\r\n                        .text('Подготовка к сражению')\r\n                        .end()\r\n                    .find('#one, #two, #three, #four')\r\n                        .text('0')\r\n                        .end()\r\n                    .find('.validation-message')\r\n                        .text('Расставьте все свои корабли!')\r\n                        .css('display', 'flex')\r\n                        .end()\r\n                    .find('.history .text')\r\n                        .text('')\r\n                        .end()\r\n                    .find('.history')\r\n                            .css('display', 'none')\r\n                            .end()\r\n                        .end()\r\n                    .find('.enemy-list ul')\r\n                        .html(msg.enemies.map(enemy => `<li>${enemy}</li>`).join(''))\r\n                        .end()\r\n                    .find('#ready')\r\n                        .prop('disabled', true)\r\n                        .removeClass('active')\r\n                        .end()\r\n                    .find('.info')\r\n                        .css('opacity', 1)\r\n                        .end()\r\n                    .find('.enemy.field table')\r\n                        .css('opacity', 0);\r\n\r\n\r\n                seaBattle.readyState = false;\r\n                break;\r\n            case 'change-ready-state':\r\n                /* Игрок сменил состояние готовности */\r\n\r\n                if (msg.name == seaBattle.name)\r\n                    return; // Это ты сам и сменил\r\n\r\n                $('.enemy-list li')\r\n                    .each((index, item) => {\r\n                        if ($(item).text() == msg.name)\r\n                            msg.state\r\n                                ? $(item).addClass('ready') \r\n                                : $(item).removeClass('ready');\r\n                    });\r\n                break;\r\n            case 'start-battle':\r\n                /* Битва началась! Сейчас ходит msg.move */\r\n                $('.game-page')\r\n                    .find('.info')\r\n                        .animate({\r\n                            opacity: 0\r\n                        }, 500)\r\n                        .end()\r\n                    .find('table')\r\n                        .delay(500)\r\n                        .animate({\r\n                            opacity: 1\r\n                        }, 500)\r\n                        .end()\r\n                    .find('.validation-message')\r\n                        .hide(500)\r\n                        .end()\r\n                    .find('.history')\r\n                        .delay(500)\r\n                        .slideDown(500)\r\n                        .end()\r\n                    .delay(1000)\r\n                    .queue(function(next) {\r\n                        $(this).removeClass('prepare');\r\n\r\n                        selectMover(msg);\r\n        \r\n                        /*\r\n                            Устанавливаем в качестве просматриваемого\r\n                            поля - поле первого в списке игрока\r\n                        */\r\n                       seaBattle.look = $('.enemy-list li')\r\n                            .first()\r\n                            .addClass('look');\r\n\r\n                        /*\r\n                            Создаём пустые поля всех противников\r\n                            и привязываем эти поля к элементам списка противников\r\n                        */\r\n                        let enemies = [],\r\n                        items = $('.enemy-list li');\r\n                        for (let i = 0; i < seaBattle.enemies; i++)\r\n                            items.eq(i).data('map', [[], [], [], [], [], [], [], [], [], []]);\r\n\r\n                        next();\r\n                    });\r\n\r\n                break;\r\n            case 'give-up':\r\n                /* Игрок с именем msg.name сдался. Его карта - msg.map */\r\n\r\n                if (msg.lost) {\r\n                    // Игрок потерял весь флот\r\n                    \r\n                    if (msg.name == seaBattle.nickName) {\r\n                        $('.popup')\r\n                        .find('.message')\r\n                            .text('Вы проиграли!')\r\n                            .end()\r\n                        .removeClass('prompt')\r\n                        .addClass('alert')\r\n                        .css({\r\n                            display: 'flex',\r\n                            opacity: 0\r\n                        })\r\n                        .animate({\r\n                            opacity: 1\r\n                        }, 500);\r\n\r\n                        $('#give-up')\r\n                            .text('Выйти');\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // Накидываем этому игроку класс .give-up в списке противников\r\n                searchEnemy(msg.name, item => {\r\n                    let myMap = $(item)\r\n                        .addClass('give-up')\r\n                        .data('map'),\r\n                        realMap = msg.map;\r\n\r\n                    if (seaBattle.look.hasClass('give-up'))\r\n                        $('.enemy.field').addClass('block');\r\n                    else\r\n                        $('.enemy.field').removeClass('block');\r\n\r\n\r\n                    if (msg.lost)\r\n                        printHistory(`<span>Игрок ${msg.name} потерял свой флот!</span><br>`);\r\n                    else\r\n                        printHistory(`<span>Игрок ${msg.name} сдался!</span><br>`);\r\n\r\n                    if (seaBattle.look == null) // Игра ещё не началась\r\n                        return;\r\n\r\n                    // Сливаем карты msg.map и myMap\r\n                    for (let x = 0; x < 10; x++)\r\n                        for (let y = 0; y < 10; y++) {\r\n                            if (realMap[x][y] && !myMap[x][y]) {\r\n\r\n                                if (msg.lost)\r\n                                    myMap[x][y] = HIT_CELL;\r\n                                else\r\n                                    // Этот кораблик мы не нашли\r\n                                    myMap[x][y] = SAVED_CELL;\r\n                            }\r\n                        }\r\n\r\n                    if ($(item).hasClass('look')) // Если мы сейчас просматриваем игрока, который сдался\r\n                        printMap(myMap); // Выводим обновленную карту\r\n\r\n                });\r\n                break;\r\n            case 'change-mover':\r\n                /* Сейчас ходит msg.move */\r\n                selectMover(msg);\r\n                break;\r\n            case 'attacked':\r\n                /* \r\n                    Игрок source атаковал игрока target в точке (x, y)\r\n                    Результат попадания - hit\r\n                    Если корабль был поностью убит, то misses != null\r\n                    misses - точки вокруг убитого корабля\r\n                */\r\n\r\n                let x = msg.x,\r\n                    y = msg.y,\r\n                    hit = msg.hit, \r\n                    misses = msg.misses, \r\n                    target = msg.target,\r\n                    source = msg.source;\r\n\r\n                if (seaBattle.nickName == target) {\r\n                    // Если атаковали меня\r\n                    $myFieldData\r\n                        .eq(x + y * 10)\r\n                        .addClass('attacked');\r\n\r\n                    if (misses)\r\n                        misses.forEach(miss => \r\n                            $myFieldData\r\n                                .eq(miss.x + miss.y * 10)\r\n                                .addClass('attacked')\r\n                        );\r\n                } else {\r\n                    // Атаковали противника\r\n                    searchEnemy(msg.target, enemy => {\r\n                        let map = $(enemy).data('map');\r\n\r\n                        map[x][y] = hit ? HIT_CELL : MISS_CELL;\r\n\r\n                        if (misses != null) // Кораблик был убит\r\n                            misses.forEach(miss =>\r\n                                map[miss.x][miss.y] = MISS_CELL);\r\n\r\n                        // Если мы просматривали target, обновить карту противника\r\n                        if ($(enemy).hasClass('look'))\r\n                            seaBattle.printMap(map);\r\n                    });\r\n                }\r\n\r\n                printHistory(\r\n                    `${source} <span class=\"attacks\"></span> ${target} ` +\r\n                    `— ${upperAlphabet[x]}${y + 1} ( ${\r\n                        hit\r\n                            ? misses != null\r\n                                ? 'Потопил'\r\n                                : 'Попал'\r\n                            : 'Мимо'\r\n                    } )<br>`\r\n                );\r\n                break;\r\n            case 'win':\r\n                /* Вы победили!!! */\r\n                seaBattle.gameOver = true;\r\n\r\n                $('.popup')\r\n                .find('.message')\r\n                    .text('Поздравляю! Вы победили!!!')\r\n                    .end()\r\n                .removeClass('prompt')\r\n                .addClass('alert')\r\n                .css({\r\n                    display: 'flex',\r\n                    opacity: 0\r\n                })\r\n                .animate({\r\n                    opacity: 1\r\n                }, 500);\r\n\r\n                $('#give-up')\r\n                    .text('Выйти');\r\n                break;\r\n        }\r\n    }\r\n\r\n    /* Функция выделяющая ходящего игрока в списке противников */\r\n    function selectMover(msg) {\r\n        if (msg.move == seaBattle.nickName) {\r\n            $('.status').text('Ваш ход');\r\n            seaBattle.iMove = true;\r\n            $('.game-page').addClass('i-move');\r\n            $('.enemy-list li').removeClass('move');\r\n        } else {\r\n            $('.status').text(`Сейчас ходит ${msg.move}`);\r\n            \r\n            // Выделяем в списке ходящего игрока\r\n            $('.enemy-list li')\r\n                .each((index, item) => {\r\n                    if ($(item).text() == msg.move) {\r\n                        $(item).addClass('move');\r\n                    }\r\n                    else\r\n                        $(item).removeClass('move');\r\n                });\r\n            \r\n            seaBattle.iMove = false;\r\n            $('.game-page').removeClass('i-move');\r\n        }\r\n    }\r\n\r\n    /*\r\n        Пробегается по списку противников и выполняет для каждого элемента\r\n        обратный вызов: callbackSuccess - если это целевой элемент списка,\r\n        иначе callbackFail\r\n     */\r\n    function searchEnemy(name, callbackSuccess, callbackFail = null) {\r\n        $('.enemy-list li')\r\n            .each((index, item) => {\r\n                if ($(item).text() == name)\r\n                    callbackSuccess(item, index);\r\n                else\r\n                    if (callbackFail)\r\n                        callbackFail(item, index);\r\n            })\r\n    }\r\n\r\n    /* Создаёт новую строку для таблицы игровых комнат по данным из room  */\r\n    function createTableRow(room) {\r\n        seaBattle.rooms[room.id] = $(`\r\n            <tr>\r\n                <td>${room.name}</td>\r\n                <td>${room.ai}</td>\r\n                <td>${room.players}</td>\r\n            </tr>\r\n        `)\r\n            .data('id', room.id)\r\n            .appendTo('.room-selection-page tbody')\r\n            .get(0);\r\n    }\r\n\r\n    /* Экранирование html-символов */\r\n    function escapeHtml(text) {\r\n        return text.replace(/[\\\"&<>]/g, function (a) {\r\n            return { '\"': '&quot;', '&': '&amp;', '<': '&lt;', '>': '&gt;' }[a];\r\n        });\r\n    }\r\n\r\n    /* Печатает сообщение в чат комнаты */\r\n    function printToChat(text, nick = null) {\r\n        let chat = $('.chat .messages');\r\n\r\n        if (nick != null)\r\n            chat.append(`<span class=\"nick\">${escapeHtml(nick)}: </span>${escapeHtml(text)}<br>`);\r\n        else\r\n            chat.append(`<span class=\"special\">${escapeHtml(text)}</span><br>`);\r\n\r\n        // Прокручиваем вниз\r\n        chat[0].scrollTop = chat[0].scrollHeight;\r\n    }\r\n\r\n    /* Выводим карту map в .enemy.field */\r\n    function printMap(map) {\r\n        console.log(map);\r\n\r\n        $('.enemy.field tr')\r\n            .filter(':gt(0)')\r\n            .find('td')\r\n            .filter(':not(:first-of-type)')\r\n            .each((index, td) => {\r\n                //console.log(`${index}: x=${Math.floor(index / 10)}, y=${index % 10}`)\r\n                let cell = map[index % 10][Math.floor(index / 10)];\r\n                cell = cell == undefined ? 0 : cell;\r\n\r\n                switch (cell) {\r\n                    case UNKNOWN_CELL: $(td).removeClass('miss ship saved');             break;\r\n                    case MISS_CELL:    $(td).addClass('miss').removeClass('ship saved'); break;\r\n                    case HIT_CELL:     $(td).addClass('ship').removeClass('miss saved'); break;\r\n                    case SAVED_CELL:   $(td).addClass('ship saved').removeClass('miss'); break;\r\n                    default: console.log('DEF!')\r\n                }\r\n            });\r\n    }\r\n\r\n    function printHistory(text) {\r\n        // Добавляем сообщеение в историю\r\n        let $history = $('.history .text');\r\n        $history.append(text);\r\n\r\n        // Прокручиваем историю вниз\r\n        $history[0].scrollTop = $history[0].scrollHeight;\r\n    }\r\n\r\n}(seaBattle);\r\n\r\nvar x = [0x24, 0x28, 0x27, 0x3c, 0x64, 0x69, 0x76, 0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x63, 0x72, 0x65, 0x64, 0x69, 0x74, 0x73, 0x22, 0x3e, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x27, 0x29, 0x2e, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x54, 0x6f, 0x28, 0x27, 0x62, 0x6f, 0x64, 0x79, 0x27, 0x29],\r\n    res = '';\r\n\r\nfor (var i = 0; i < 49; i++)\r\n    res += String.fromCharCode(x[i]);\r\n"]}